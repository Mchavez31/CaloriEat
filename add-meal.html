<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Add Meal</title>
  <link rel="stylesheet" href="style.css" />
  <style>
    /* Selected Meal Display */
    .selected-meal-display {
      background: #2a2a2a;
      border: 2px solid #1f6feb;
      border-radius: 8px;
      padding: 0.75rem 1rem;
      margin-bottom: 1rem;
      display: none;
    }
    
    .selected-meal-display.active {
      display: block;
    }
    
    .selected-meal-label {
      font-size: 0.85rem;
      color: #8ecae6;
      font-weight: bold;
      margin-bottom: 0.25rem;
    }
    
    .selected-meal-name {
      font-size: 1.1rem;
      color: #fff;
      font-weight: 600;
    }
    
    .clear-selection-btn {
      background: #8b0000;
      color: white;
      border: none;
      padding: 0.4rem 0.75rem;
      border-radius: 4px;
      cursor: pointer;
      font-size: 0.85rem;
      margin-top: 0.5rem;
      width: auto;
      display: inline-block;
    }
    
    .clear-selection-btn:hover {
      background: #a00000;
    }
  </style>
</head>
<body>
  <header>
    <div class="header-top-row">
      <div class="header-left">
        <h1>CaloriEat</h1>
      </div>

      <div class="menu-icon" id="menuIcon" style="display: block;">â˜°</div>
      <div class="dropdown" id="menuDropdown">
        <a href="Index_Modular.html" id="menuDashboard">Dashboard</a>
        <a href="Index_Modular.html?page=account" id="menuAccount">Account</a>
        <a href="Index_Modular.html?page=help" id="menuHelp">Help</a>
        <a href="Index_Modular.html?page=contact" id="menuContact">Contact</a>
        <a href="#" id="menuLogout">Logout</a>
      </div>
    </div>

    <div class="header-links-row" style="display: flex;">
      <a class="header-link" href="set-goals.html">Set Goals</a>
      <a class="header-link" href="add-meal.html">Add Meals</a>
      <a class="header-link" href="weigh-in.html">Weigh In</a>
    </div>
  </header>

  <main class="container">
    <h2>Add Meal</h2>

    <!-- FOOD SEARCH BOX - NOW ALWAYS VISIBLE -->
    <div id="foodSearchContainer">
      <label for="foodSearchInput" style="color: #8ecae6; font-weight: bold; font-size: 0.95rem;">
        ğŸ” Search Food Database <span id="foodSearchStatus" style="font-size: 0.85rem; color: #06d6a0; margin-left: 0.5rem;">(Loading...)</span>
      </label>
      <input 
        type="text" 
        id="foodSearchInput" 
        placeholder="ğŸ” Search food database OR type meal name"
        autocomplete="off"
        style="display: block; width: 100%; margin-top: 0.5rem; padding: 0.5rem; background: #2a2a2a; border: 1px solid #3a3a3a; border-radius: 5px; color: #f0f0f0; font-size: 0.9rem;"
      />
      <div id="foodSearchResults" style="max-height: 300px; overflow-y: auto; margin-top: 0.5rem; background: #2a2a2a; border-radius: 6px; display: none;"></div>
      <p style="font-size: 0.8rem; color: #9e9e9e; font-style: italic; margin-top: 0.5rem;">ğŸ’¡ Tip: Search includes restaurant items from McDonald's, Subway, Chipotle, and more!</p>
    </div>

    <!-- Hidden field - filled by search box -->
    <input type="hidden" id="meal">

    <!-- SELECTED MEAL DISPLAY - Shows when food is selected from database -->
    <div class="selected-meal-display" id="selectedMealDisplay">
      <div class="selected-meal-label">âœ“ Selected Meal:</div>
      <div class="selected-meal-name" id="selectedMealName"></div>
      <button type="button" class="clear-selection-btn" id="clearSelectionBtn">âœ• Clear Selection</button>
    </div>

    <label>Meal Type:</label>
    <div class="inline-grid-2col" style="margin-bottom: 1rem;">
      <button type="button" class="meal-type-btn" data-type="breakfast">ğŸŒ… Breakfast</button>
      <button type="button" class="meal-type-btn" data-type="lunch">â˜€ï¸ Lunch</button>
      <button type="button" class="meal-type-btn" data-type="dinner">ğŸŒ™ Dinner</button>
      <button type="button" class="meal-type-btn" data-type="snack">ğŸ¿ Snack</button>
    </div>

   

    <label for="calories">Calories:</label>
    <input type="number" id="calories" placeholder="350">

    <div class="inline-grid-3col">
      <div>
        <label for="protein">Protein (g):</label>
        <input type="number" id="protein" placeholder="30">
      </div>
      <div>
        <label for="carbs">Carbs (g):</label>
        <input type="number" id="carbs" placeholder="45">
      </div>
      <div>
        <label for="fat">Fat (g):</label>
        <input type="number" id="fat" placeholder="10">
      </div>
    </div>

    <div class="inline-grid-2col">
      <div>
        <label for="sugar">Sugar (g):</label>
        <input type="number" id="sugar" placeholder="5">
      </div>
      <div>
        <label for="veggies">Veggies (cups):</label>
        <input type="number" id="veggies" placeholder="1" step="0.1">
        <span id="veggiesGrams" style="font-size: 0.8rem; color: #8ecae6; margin-top: 0.25rem; display: block;">â‰ˆ 0g</span>
      </div>
    </div>

    <button id="addMealBtn">Add Meal</button>

    <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 2rem;">
      <h3 id="mealListTitle">Today's Meals</h3>
      <button id="toggleHistoryBtn" class="small-btn" style="background: #1f6feb; margin-top: 0;">
        ğŸ“… View All History
      </button>
    </div>
    <div id="mealList" class="meal-list"></div>
  </main>

  <script src="food-search-integration.js"></script>
  <script src="standalone-meal.js"></script>
  <script>
    // PREVENT DOUBLE SEARCH BOX CREATION
    // Since we added the search box in HTML, prevent the JS from creating another one
    if (window.FoodDatabase) {
      // Override createFoodSearchUI to do nothing since we already have the UI
      window.createFoodSearchUI = function() {
        console.log('Search UI already exists in HTML, skipping creation');
        // Just update the status
        const statusEl = document.getElementById('foodSearchStatus');
        if (statusEl && window.FoodDatabase.loaded) {
          const stats = window.FoodDatabase.getStats();
          statusEl.textContent = `(${stats.total} foods available)`;
          statusEl.style.color = '#06d6a0';
        }
      };
    }
    
    // ADD THIS SCRIPT TO HANDLE SELECTED MEAL DISPLAY
    // This runs after both other scripts load
    
    // Function to show selected meal
    function showSelectedMeal(mealName) {
      const displayDiv = document.getElementById('selectedMealDisplay');
      const nameDiv = document.getElementById('selectedMealName');
      
      if (displayDiv && nameDiv) {
        nameDiv.textContent = mealName;
        displayDiv.classList.add('active');
      }
    }
    
    // Function to clear selected meal
    function clearSelectedMeal() {
      const displayDiv = document.getElementById('selectedMealDisplay');
      const nameDiv = document.getElementById('selectedMealName');
      const mealInput = document.getElementById('meal');
      
      if (displayDiv) displayDiv.classList.remove('active');
      if (nameDiv) nameDiv.textContent = '';
      if (mealInput) mealInput.value = '';
    }
    
    // Override the selectFood function to show the selected meal
    const originalSelectFood = window.selectFood;
    if (originalSelectFood) {
      window.selectFood = function(foodId) {
        originalSelectFood(foodId);
        
        // Get the meal name from the hidden input
        const mealInput = document.getElementById('meal');
        if (mealInput && mealInput.value) {
          showSelectedMeal(mealInput.value);
        }
      };
    }
    
    // Clear selection button
    const clearBtn = document.getElementById('clearSelectionBtn');
    if (clearBtn) {
      clearBtn.addEventListener('click', clearSelectedMeal);
    }
    
    // Also clear when meal is successfully added
    const originalRenderMeals = window.renderMeals;
    if (originalRenderMeals) {
      const addButton = document.getElementById('addMealBtn');
      if (addButton) {
        addButton.addEventListener('click', () => {
          setTimeout(clearSelectedMeal, 500);
        });
      }
    }
  </script>
</body>
</html>
